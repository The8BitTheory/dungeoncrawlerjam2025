#RetroDevStudio.MetaData.BASIC:7169,BASIC V7.0,uppercase,10,10
10 FD=0:PP=26
20 DEF FN MV(ZZ)=M(PP+V(FD,ZZ))>0

30 GRAPHIC0:GOSUB 10000

40 REM CL=CHECKLIST:RL=RENDERLIST:M=MAP:VL=VIEWLIST

50 W=8:DIM CL(3),RL(8),M(63),V(3,21):DATA 1,1,1,1,1,1,1,1, 1,0,0,0,0,0,0,1, 1,1,0,1,0,1,0,1, 1,0,0,0,0,0,0,1

60 DATA 1,0,1,0,1,1,0,1, 1,0,1,0,1,1,0,1, 1,0,0,0,0,1,0,1, 1,1,1,1,1,1,1,1:FOR X=0TO63:READ MV:M(X)=MV:NEXT


#  FACING NORTH
80 L=-1:R=-L:F=-W:B=-F:D=0:GOSUB 90
#  FACING EAST
81 L=-W:R=-L:F=1:B=-F:D=1:GOSUB 90
#  FACING SOUTH
82 L=1:R=-1:F=W:B=-F:D=2:GOSUB 90
#  FACING WEST
83 L=W:R=-L:F=-1:B=-F:D=3:GOSUB 90

84 GOTO 100


#  DIRECTION MAPPING COORDINATES
90 V(D,1)=L:V(D,2)=R
91 V(D,3)=L+F:V(D,4)=F:V(D,5)=R+F
92 V(D,6)=V(D,3):V(D,7)=V(D,5)
93 V(D,8)=L+F+F:V(D,9)=V(D,8):V(D,10)=F+F:V(D,11)=F+F+R:V(D,12)=V(D,11)
94 V(D,13)=F+F+L:V(D,14)=F+F+R
95 V(D,15)=L+F+F+F:V(D,16)=V(D,15):V(D,17)=F+F+F:V(D,18)=F+F+F+R:V(D,19)=V(D,18)
96 RETURN

100 REM GO AHEAD
#101 PRINT ""
#102 FOR Y=0TO3:FORX=1TO19:PRINT V(Y,X);:NEXT:PRINT:NEXT
#103 END

230 GOTO 300
240 GETKEY I$
250 IF ASC(I$)=157 THEN FD=FD-1:IF FD<0 THEN FD=3
260 IF ASC(I$)=29 THEN FD=FD+1:IF FD>3 THEN FD=0
270 IF ASC(I$)=145 THEN GOSUB 860
280 IF ASC(I$)=17 THEN GOSUB 930
290 IF I$="Q" THEN SLOW:GRAPHIC0:END
300 S=TI:RX=0
310 CL(0)=20:CL(1)=17:GOSUB520
320 CL(0)=21:CL(1)=19:GOSUB520
330 GOSUB 400:REM HERE-CENTER
340 CV=0:GOSUB620
350 REM PRINT TI-S
360 REM FORX=0TO8:PRINTRL(X);:NEXT:PRINT
370 REM IF FD<3 THEN FD=FD+1:GOTO 60
380 GOSUB 1000:GOTO240
390 END

400 REM HERE-CENTER
410 IF FNMV(18) THEN CV=18:GOSUB620:RETURN
420 CL(0)=14:CL(1)=10:CL(2)=6:CL(3)=1:GOSUB520
430 CL(0)=15:CL(1)=12:CL(2)=9:CL(3)=5:GOSUB520
440 GOSUB 460:REM NEAR-CENTER
450 RETURN

460 REM NEAR-CENTER
470 IF FNMV(11) THEN CV=11:GOSUB620:RETURN
480 CL(0)=7:CL(1)=2:CL(3)=0:GOSUB520
490 CL(0)=8:CL(1)=4:GOSUB 520
500 IF FNMV(3) THEN CV=3:GOSUB620
510 RETURN

520 REM CHECK-LISTS
530 REM PRINT"CHECKING";
540 REM FORX=0TO3:PRINTCL(X);:NEXT:PRINT
550 CX=0
560 DO
570  CV=CL(CX):RS=FNMV(CV)
580  IF RS THEN GOSUB 620
590  CX=CX+1:IF CX>3 THEN EXIT
600  LOOP WHILE RS>=0
610 RETURN

620 REM ADD VALUE TO RENDERLIST
630 REM PRINT CV
640 RL(RX)=CV:RX=RX+1:RETURN



860 T=PP
870 IF FD=0 THEN PP=PP-W:GOTO 910
880 IF FD=2 THEN PP=PP+W:GOTO 910
890 IF FD=1 THEN PP=PP+1:GOTO 910
900 IF FD=3 THEN PP=PP-1:GOTO 910
910 IF M(PP)>0 THEN PP=T
920 RETURN
930 T=PP
940 IF FD=0 THEN PP=PP+W:GOTO 980
950 IF FD=2 THEN PP=PP-W:GOTO 980
960 IF FD=1 THEN PP=PP-1:GOTO 980
970 IF FD=3 THEN PP=PP+1:GOTO 980
980 IF M(PP)>0 THEN PP=T
990 RETURN

1000 RX=0:GRAPHIC1,1

1010 DO
1020  DV=RL(RX):IF DV=0 THEN 1050

1030  DRAW 1,DC(DV,0),DC(DV,1) TO DC(DV,2),DC(DV,3) TO DC(DV,4),DC(DV,5) TO DC(DV,6),DC(DV,7) TO DC(DV,0),DC(DV,1)

1040  RX=RX+1
1050 LOOP WHILE DV>0
1060 RETURN


##############################################


10000 REM GRAPHIC SETUP


10010 DD=PEEK(186)
10020 BE=PEEK(4624)+PEEK(4625)*256
10030 BLOAD"VDCBASIC2D.0AC6",B0,U(DD):SYSDEC("AC6")
10040 AP=0:DISP49535:ATTR AP

10050 RGW0,127:RGW4,155:RGW6,100:RGW7,140:RGW9,1
10060 RGO25,128:REM BITMAP MODE ON
10070 RGO28,24:REM 64K VRAM
10080 RGW36,0
10090 RGW DEC("1A"),DEC("FF")

10100 VMF49535,15,AP:REM SETUP PIXELS
10110 VMFAP,0,8000:REM CLEAR ATTRIBUTE RAM
10120 DA=AP+8000


10130 FI$="WALLS.VDR"
10140 ?"LOADING "FI$"...";:BLOAD (FI$),B0,P(BE):? "DONE"

10150 FL=PEEK(174)+PEEK(175)*256-BE:?"LENGTH:"FL

10160 DC=PEEK(BE):PRINT DC " ENTRIES"
10170 DIM DM(DC-1,3)

10180 D=6*DC+1
10190 FL=FL-D

10200 ?"RTV TO "DA

10210 RTV BE+D,DA,FL

10220 FOR FI=0 TO DC-1

10230  PA=BE+1+FI*6

10240  DM(FI,0)=PEEK(PA)+PEEK(PA+1)*256
10250  DM(FI,1)=PEEK(PA+2)
10260  DM(FI,2)=PEEK(PA+3)
10270  DM(FI,3)=PEEK(PA+4)+PEEK(PA+5)*256

10280  PRINT DM(FI,0)" "DM(FI,1)" "DM(FI,2)" "DM(FI,3)

10290 NEXT


10300 RETURN