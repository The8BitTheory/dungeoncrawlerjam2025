#RetroDevStudio.MetaData.BASIC:7169,BASIC V7.0 VDC,uppercase,10,10
10 FD=0:PP=26

30 GRAPHIC0:GOSUB 10000

40 REM CL=CHECKLIST:RL=RENDERLIST:M=MAP:VL=VIEWLIST

50 W=8:DIM CL(3),RL(8),M(63),V(3,19):DATA 1,1,1,1,1,1,1,1, 1,0,0,0,0,0,0,1, 1,1,0,1,0,1,0,1, 1,0,0,0,0,0,0,1

60 DATA 1,0,1,0,1,1,0,1, 1,0,1,0,1,1,0,1, 1,0,0,0,0,1,0,1, 1,1,1,1,1,1,1,1:FOR X=0TO63:READ MV:M(X)=MV:NEXT


#  FACING NORTH
80 L=-1:R=-L:F=-W:B=-F:D=0:GOSUB 90
#  FACING EAST
81 L=-W:R=-L:F=1:B=-F:D=1:GOSUB 90
#  FACING SOUTH
82 L=1:R=-1:F=W:B=-F:D=2:GOSUB 90
#  FACING WEST
83 L=W:R=-L:F=-1:B=-F:D=3:GOSUB 90

84 GOTO 100


#  DIRECTION MAPPING COORDINATES
90 V(D,1)=L:V(D,2)=R
91 V(D,3)=L+F:V(D,4)=F:V(D,5)=R+F
92 V(D,6)=V(D,3):V(D,7)=V(D,5)
93 V(D,8)=L+F+F:V(D,9)=V(D,8):V(D,10)=F+F:V(D,11)=F+F+R:V(D,12)=V(D,11)
94 V(D,13)=F+F+L:V(D,14)=F+F+R
95 V(D,15)=L+F+F+F:V(D,16)=V(D,15):V(D,17)=F+F+F:V(D,18)=F+F+F+R:V(D,19)=V(D,18)
96 RETURN

100 REM GO AHEAD
#101 PRINT ""
#102 FOR Y=0TO3:FORX=1TO19:PRINT V(Y,X);:NEXT:PRINT:NEXT
#103 END

230 FD=0:GOTO 300
240 SLOW:GETKEY I$:FAST
250 IF ASC(I$)=157 THEN FD=FD-1:IF FD<0 THEN FD=3
260 IF ASC(I$)=29 THEN FD=FD+1:IF FD>3 THEN FD=0
270 IF ASC(I$)=145 THEN GOSUB 860
280 IF ASC(I$)=17 THEN GOSUB 930
290 IF I$="Q" THEN SLOW:GRAPHIC0:END
300 S=TI:RX=0

310 C$="ACH":GOSUB 620
320 C$="BEL":GOSUB 620

330 GOSUB 410:REM HERE-CENTER

370 RL(RX)=0
380 GOSUB 1000:GOTO240
390 END

#   HERE-CENTER
410 IF FNM(4) THEN RL(RX)=4:RX=RX+1:RETURN
420 C$="FIO":GOSUB620
430 C$="GKS":GOSUB620
440 GOSUB470:REM NEAR-CENTER
450 RETURN

#   NEAR-CENTER
470 IF FNM(10) THEN RL(RX)=10:RX=RX+1:RETURN

480 C$="MP":GOSUB620
490 C$="NR":GOSUB620

500 IF FNM(17) THEN RL(RX)=17:RX=RX+1
510 RETURN

# ADD VALUE TO RENDERLIST
620 G=1:PRINT "CHECKING "C$
630 DO
640  C=ASC(MID$(C$,G,1))-64
650  S=FN M(C)
655  PRINT "  "C"="S
660  IF S THEN RL(RX)=C:RX=RX+1
670  G=G+1
680  IF G>LEN(C$) THEN EXIT
690 LOOP WHILE S>=0
700 RETURN



860 T=PP
870 IF FD=0 THEN PP=PP-W:GOTO 910
880 IF FD=2 THEN PP=PP+W:GOTO 910
890 IF FD=1 THEN PP=PP+1:GOTO 910
900 IF FD=3 THEN PP=PP-1:GOTO 910
910 IF M(PP)>0 THEN PP=T
920 RETURN
930 T=PP
940 IF FD=0 THEN PP=PP+W:GOTO 980
950 IF FD=2 THEN PP=PP-W:GOTO 980
960 IF FD=1 THEN PP=PP-1:GOTO 980
970 IF FD=3 THEN PP=PP+1:GOTO 980
980 IF M(PP)>0 THEN PP=T
990 RETURN

1000 RX=0:VMF AP,0,8000

1010 DO
1020  DV=RL(RX):IF DV=0 THEN 1050

1025   PRINT DV:DV=DV-1

1029   BW=DM(DV,1)

1030   VMC DA+DM(DV,0),AP+DM(DV,4),BW,DM(DV,2),80,BW

#1030  DRAW 1,DC(DV,0),DC(DV,1) TO DC(DV,2),DC(DV,3) TO DC(DV,4),DC(DV,5) TO DC(DV,6),DC(DV,7) TO DC(DV,0),DC(DV,1)

1040  RX=RX+1
1050 LOOP WHILE DV>0
1055 PRINT"."
1060 RETURN


##############################################


10000 REM GRAPHIC SETUP

#10010 DEF FN MV(ZZ)=M(PP+V(FD,ZZ))>0
10020 DEF FN PA(ZZ)=7*ZZ+1
10025 DEF FN PW(ZZ)=PEEK(ZZ)+PEEK(ZZ+1)*256
10026 DEF FN M(Z)=M(PP+V(FD,Z))=1


10030 DD=PEEK(186)
10040 BE=PEEK(4624)+PEEK(4625)*256
10050 BLOAD"VDCBASIC2D.0AC6",B0,U(DD):SYSDEC("AC6")
10060 AP=0:DISP49535:ATTR AP

10070 RGW 0,127:RGW4,155:RGW6,100:RGW7,140:RGW9,1
10080 RGO 25,128:REM BITMAP MODE ON
10090 RGO 28,24:REM 64K VRAM
10100 RGW 36,0
10110 RGW DEC("1A"),DEC("FF")

10120 VMF 49535,15,AP:REM SETUP PIXELS
10130 VMF AP,0,8000:REM CLEAR ATTRIBUTE RAM
10140 DA=AP+8000


10150 FI$="WALLS.VDC"
10160 ?"LOADING "FI$"...";:BLOAD (FI$),B0,P(BE):? "DONE"

10170 FL=PEEK(174)+PEEK(175)*256-BE:?"LENGTH:"FL

10180 DC=PEEK(BE):PRINT DC " ENTRIES"
10185 DIM DM(DC-1,4)
10190 D=FNPA(DC)
10200 FL=FL-D

10210 FAST

#     COPY WALLSET FROM RAM TO VRAM
10220 RTV BE+D,DA,FL

#     WRITE WALLSET-METADATA TO ARRAY
#     0,1:OFFSET
#       2:WIDTH IN BYTES (1 BYTE = 2 PIXELS)
#       3:HEIGHT IN SCANLINES
#       4:SIZE OF TILE (LENGTH IN BYTES)
#     5,6:POSITION OF TILE ON SCREEN
10230 FOR FI=0 TO DC-1
10240  PA=BE+FNPA(FI)
10250  DM(FI,0)=FNPW(PA)
10260  DM(FI,1)=PEEK(PA+2)
10270  DM(FI,2)=PEEK(PA+3)
10280  DM(FI,3)=FNPW(PA+4)
10290  DM(FI,4)=PEEK(PA+6)
#10300  PRINT DM(FI,0)" "DM(FI,1)" "DM(FI,2)" "DM(FI,3)
10310 NEXT

#10320 SLOW



10330 RETURN